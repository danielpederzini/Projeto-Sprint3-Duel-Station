<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duel Station | Game</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/game.css">
    <link rel="icon" href="img/logo.png">
    <script src="script/general.js"></script>
    <script src="script/general_logged.js"></script>
    <script src="script/game.js"></script>
</head>

<body onload="check_login()">

    <div class="header">

        <div class="navbar">

            <ul>
                <li>
                    <a href="hub.html">
                        <p>Hub</p>
                    </a>
                </li>

                <li>
                    <a>
                        <img src="img/logo.png">
                        <b>Play</b>
                    </a>
                </li>

                <li>
                    <a href="store.html">
                        <p>Store</p>
                    </a>
                </li>

                <li>
                    <a href="profile.html">
                        <p id="p_user_name">Profile</p>
                    </a>
                </li>

                <li class="currency">

                    <img src="img/coin.png" alt="Coin Icon">
                    <p id="p_currency">0.00</p>

                </li>

                <li>
                    <a onclick="logoff()">
                        <p>Logoff</p>
                    </a>
                </li>

                <li class="nav_icon">

                    <img id="muted_music" src="img/muted.png" onclick="play_music()">

                    <img id="playing_music" src="img/playing.png" onclick="stop_music()" style="display: none;">

                </li>

                <li class="nav_icon">

                    <img src="img/settings.png" onclick="show_settings()">

                </li>

            </ul>

        </div>

    </div>

    <div class="game_banner">

        <div class="options" id="div_player_options">

            <div class="selection">

                <b>Select Your Duelist</b>

                <div class="selection_list">

                    <button id="bt_player1001" onclick="change_player(1001)">
                        <img src="img/players/player1.png">
                        <p>Seto Kaiba</p>
                        <p>+200 LP</p>
                    </button>

                    <button id="bt_unknown_player1002" onclick="show_redirect_modal()">
                        <img src="img/unknown.png">
                        <p>Mako Tsunami</p>

                        <div class="price">
                            <img src="img/coin.png" alt="Coin Icon">
                            <p>250.00</p>
                        </div>
                    </button>

                    <button id="bt_player1002" onclick="change_player(1002)" style="display: none;">
                        <img src="img/players/player2.png">
                        <p>Mako Tsunami</p>

                        <p>+15% Defense</p>
                    </button>

                    <button id="bt_unknown_player1003" onclick="show_redirect_modal()">
                        <img src="img/unknown.png">
                        <p>S. Leblanc</p>

                        <div class="price">
                            <img src="img/coin.png" alt="Coin Icon">
                            <p>500.00</p>
                        </div>
                    </button>

                    <button id="bt_player1003" onclick="change_player(1003)" style="display: none;">
                        <img src="img/players/player3.png">
                        <p>S. Leblanc</p>

                        <p>+25% Profit</p>
                    </button>

                    <button id="bt_unknown_player1004" onclick="show_redirect_modal()">
                        <img src="img/unknown.png">
                        <p>Yami Yugi</p>

                        <div class="price">
                            <img src="img/coin.png" alt="Coin Icon">
                            <p>750.00</p>
                        </div>
                    </button>

                    <button id="bt_player1004" onclick="change_player(1004)" style="display: none;">
                        <img src="img/players/player4.png">
                        <p>Yami Yugi</p>

                        <p>+5% Attack</p>
                    </button>

                    <button id="bt_unknown_player1005" onclick="show_redirect_modal()">
                        <img src="img/unknown.png">
                        <p>Yami Marik</p>

                        <div class="price">
                            <img src="img/coin.png" alt="Coin icon">
                            <p>1000.00</p>
                        </div>
                    </button>

                    <button id="bt_player1005" onclick="change_player(1005)" style="display: none;">
                        <img src="img/players/player5.png">
                        <p>Yami Marik</p>

                        <p>+10% Vampirism</p>
                    </button>

                </div>

                <button class="button1" onclick="next()">Next</button>

            </div>

        </div>

        <div class="options" id="div_deck_options" style="display: none;">

            <div class="selection">

                <b>Select Your Deck</b>

                <div class="selection_list">

                    <button id="bt_deck1001" onclick="change_deck(1001)">
                        <img src="img/types/type0.png">
                        <p>Winged</p>

                        <p>Fly</p>
                    </button>

                    <button id="bt_unknown_deck1002" onclick="show_redirect_modal()">
                        <img src="img/unknown.png">
                        <p>Aquatic</p>

                        <div class="price">
                            <img src="img/coin.png" alt="Coin Icon">
                            <p>250.00</p>
                        </div>
                    </button>

                    <button id="bt_deck1002" onclick="change_deck(1002)" style="display: none;">
                        <img src="img/types/type20.png">
                        <p>Aquatic</p>

                        <p>Sea Healing</p>
                    </button>

                    <button id="bt_unknown_deck1003" onclick="show_redirect_modal()">
                        <img src="img/unknown.png">
                        <p>Earthy</p>

                        <div class="price">
                            <img src="img/coin.png" alt="Coin Icon">
                            <p>500.00</p>
                        </div>
                    </button>

                    <button id="bt_deck1003" onclick="change_deck(1003)" style="display: none;">
                        <img src="img/types/type40.png">
                        <p>Earthy</p>

                        <p>Earth Fury</p>
                    </button>

                    <button id="bt_unknown_deck1004" onclick="show_redirect_modal()">
                        <img src="img/unknown.png">
                        <p>Dark</p>

                        <div class="price">
                            <img src="img/coin.png" alt="Coin Icon">
                            <p>750.00</p>
                        </div>
                    </button>

                    <button id="bt_deck1004" onclick="change_deck(1004)" style="display: none;">
                        <img src="img/types/type60.png">
                        <p>Dark</p>

                        <p>Last Whisper</p>
                    </button>

                    <button id="bt_unknown_deck1005" onclick="show_redirect_modal()">
                        <img src="img/unknown.png">
                        <p>Divine</p>

                        <div class="price">
                            <img src="img/coin.png" alt="Coin Icon">
                            <p>1000.00</p>
                        </div>
                    </button>

                    <button id="bt_deck1005" onclick="change_deck(1005)" style="display: none;">
                        <img src="img/types/type80.png">
                        <p>Divine</p>

                        <p>The Awakening</p>
                    </button>

                </div>

                <button class="button1" onclick="start()">It's time to duel!</button>

            </div>

        </div>

        <div class="board" id="div_board" style="display: none;">

            <div class="stats">

                <div class="stats_box">
                    <img id="img_player">
                    <p><span id="span_player_lifepoints">5000</span> LP</p>
                </div>

                <div class="stats_box">
                    <b>Round <span id="span_round"></span></b>
                </div>

                <div class="stats_box">
                    <img src="img/players/enemy.png">
                    <p><span id="span_enemy_lifepoints">5000</span> LP</p>
                </div>

            </div>

            <div class="versus_cards">

                <div class="card_template" id="div_card">
                    <img id="img_card">

                    <div class="card_desc">
                        <p id="p_card_name"></p>

                        <div class="card_attack">
                            <b id="p_attack"></b>
                            <img id="img_type">
                        </div>
                    </div>
                </div>

                <b>VS</b>

                <div class="card_template" id="div_enemy_card">
                    <img id="img_enemy_card">

                    <div class="card_desc">
                        <p id="p_enemy_card_name"></p>

                        <div class="card_attack">
                            <b id="p_enemy_attack"></b>
                            <img id="img_enemy_type">
                        </div>
                    </div>
                </div>

            </div>

            <div class="game_buttons">

                <button id="bt_ability1001" class="button1" onclick="fly()" style="display: none;">Fly</button>
                <button id="bt_ability1002" class="button1" onclick="sea_healing()" style="display: none;">Sea
                    Healing</button>
                <button id="bt_ability1003" class="button1" onclick="earth_fury()" style="display: none;">Earth
                    Fury</button>
                <button id="bt_ability1004" class="button1" onclick="last_whisper()" style="display: none;">Last
                    Whisper</button>
                <button id="bt_ability1005" class="button1" onclick="the_awakening()" style="display: none;">The Awakening</button>

                <button id="bt_attack" class="button2" onclick="attack()">Attack</button>

            </div>

        </div>

        <div class="result" id="div_result">
            <p id="p_result"></p>
            <div id="div_new_currency"></div>
            <button class="button1" onclick="reset()">Play Again</button>
        </div>

        <div class="modal_shadow" id="modal_shadow" style="display: none;">

            <div class="modal" id="redirect_modal" style="display: none;">

                <b>Want to go to the Store?</b>

                <div>

                    <button class="button1" onclick="close_window()">
                        <p>🡸</p>
                    </button>

                    <button class="button2" onclick="go_to_store()">
                        <p>Go</p>
                    </button>

                </div>

            </div>

            <div class="modal" id="settings_modal" style="display: none;">

                <b>Settings</b>

                <br><br>

                <form id="form_settings" autocomplete="off" onsubmit="return save_settings()">

                    <p>Player Name</p>
                    <input id="in_new_name" type="text" name="new_name">

                    <br><br>

                    <div>

                        <p>Tutorial</p>
                        <input id="in_tutorial_status" type="checkbox" name="tutorial_status" checked>

                    </div>

                    <br><br>

                    <p>Profile Background (URL)</p>
                    <input id="in_background_url" type="text" name="background_url" onkeyup="show_preview()">

                    <br><br>

                    <img id="img_background_preview" alt="Not an image">

                    <br><br>

                    <div>

                        <div class="button1" onclick="close_window()">
                            <p>🡸</p>
                        </div>

                        <button class="button2" onclick="save_settings()">
                            <p>Save</p>
                        </button>

                    </div>

                </form>

            </div>

            <div class="modal" id="success_settings_modal" style="display: none;">

                <b>Successfully Saved Your Changes!</b>

                <p>Sign In Again to Apply Them</p>

                <button class="button2" onclick="logoff()">Ok</button>

            </div>

            <div class="modal" id="failure_settings_modal" style="display: none;">

                <b>Couldn't Save Your Changes!</b>

                <p>Try again later</p>

                <button class="button2" onclick="close_window()">Back</button>

            </div>

        </div>

        <div class="logo">

            <img src="img/logo.png" alt="Logo Duel Station">
            <p>© 2021 Duel Station</p>

        </div>

</body>

</html>

<script>

    // Valida os duelistas que o usuário possui e exibe as imagens deles no lugar das interrogações
    fetch(`/compras/validar_duelistas/${user_id}`, {
        method: "GET",
    }).then(resultado => {

        if (resultado.ok) {

            resultado.json().then(json => {

                for (var i = 0; i < json.length; i++) {

                    document.getElementById(`bt_unknown_player${json[i].fkDuelista}`).style.display = `none`;
                    document.getElementById(`bt_player${json[i].fkDuelista}`).style.display = `block`;

                }

            });

        } else {
            console.log(`Couldn't get user items`);

            resultado.text().then(texto => {
                console.error(texto);
            });

        }
    });

    // Valida os decks que o usuário possui e exibe as imagens deles no lugar das interrogações
    fetch(`/compras/validar_decks/${user_id}`, {
        method: "GET",
    }).then(resultado => {

        if (resultado.ok) {

            resultado.json().then(json => {

                for (var i = 0; i < json.length; i++) {

                    console.log(json);
                    document.getElementById(`bt_unknown_deck${json[i].fkDeck}`).style.display = `none`;
                    document.getElementById(`bt_deck${json[i].fkDeck}`).style.display = `block`;

                }

            });

        } else {
            console.log(`Couldn't get user items`);

            resultado.text().then(texto => {
                console.error(texto);
            });

        }
    });

    // Recarrega a página para jogar novamente
    function reset() {
        document.location.reload();
    }

    // Exibe o modal de redirecionamento para a loja
    function show_redirect_modal() {
        modal_shadow.style.display = `flex`;
        redirect_modal.style.display = `flex`;
    }

    // Redireciona o usuário para a loja
    function go_to_store() {
        window.location.href = `store.html`
    }

    // Fecha todos modais
    function close_window() {
        modal_shadow.style.display = `none`;

        redirect_modal.style.display = `none`;
        settings_modal.style.display = `none`;
    }

</script>